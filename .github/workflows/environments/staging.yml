# Staging Environment Configuration
# This file defines the configuration for the staging environment
# Used by the unified deployment workflow

name: staging
url: https://staging.boximity.ca

# Branch restrictions
branches:
  - staging

# Environment protection rules
protection_rules:
  required_reviewers: 1
  required_checks:
    - build
    - test
    - lint
  restrict_pushes: true
  allow_force_pushes: false
  allow_deletions: false

# Environment variables
variables:
  ENVIRONMENT: staging
  APP_URL: https://staging.boximity.ca
  DEBUG: true
  NODE_ENV: staging

  # Application configuration
  NEXT_PUBLIC_APP_ENV: staging
  NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY: pk_test_51S7c8DKZd4rSrt9n4kQU2lE9dZ9vSbpAkGRYu0qNRTMBmNvRxQvpFiYOIK2sZGkrmdQQAEaNxugOMGcXYLINRLCF00wuy1qoap
  NEXT_PUBLIC_PRODUCTION_GA_ID: G-LY1EGSWRVE

  # Umami Analytics (Staging)
  UMAMI_WEBSITE_ID: umami-website-staging-001
  UMAMI_HOST_URL: https://umami.staging.boximity.ca
  UMAMI_FORCE_HTTPS: true
  UMAMI_DISABLE_TELEMETRY: true
  UMAMI_LOG_LEVEL: info

  # Feature flags
  ENABLE_DEBUG_LOGGING: true
  ENABLE_PERFORMANCE_MONITORING: true

# Required secrets (these must be set in GitHub Environment Secrets)
secrets:
  # Infrastructure
  - DO_TOKEN
  - SSH_PRIVATE_KEY
  - SSH_KEY_FINGERPRINT
  - SPACES_ACCESS_ID
  - SPACES_SECRET_KEY

  # Application secrets
  - BREVO_API_KEY
  - STRIPE_SECRET_KEY
  - ANSIBLE_VAULT_PASSWORD

  # Umami Database
  - UMAMI_DB_PASSWORD
  - UMAMI_APP_SECRET
  - UMAMI_ADMIN_PASSWORD

  # GitHub
  - GITHUB_TOKEN

# Deployment configuration
deployment:
  terraform_workspace: staging
  ansible_playbook: staging-deploy.yml
  health_check_endpoint: /api/health
  health_check_timeout: 300

  # Testing configuration
  enable_e2e_tests: true
  enable_integration_tests: true
  test_timeout: 600

  # Rollback configuration
  rollback_enabled: true
  rollback_timeout: 1800
  auto_rollback_on_failure: false

# Monitoring and alerting
monitoring:
  enable_health_checks: true
  enable_metrics_collection: true
  alert_on_failure: true
  notification_channels: ["github", "slack"]

  # Performance thresholds
  response_time_threshold_ms: 5000
  error_rate_threshold: 0.05
  uptime_sla: 0.95

# Resource allocation
resources:
  droplet_size: s-2vcpu-4gb
  disk_size_gb: 50
  backup_schedule: daily

# Security configuration
security:
  enable_https_redirect: true
  enable_security_headers: true
  enable_rate_limiting: true
  rate_limit_requests_per_hour: 1000

  # Firewall rules
  allowed_ips:
    - "0.0.0.0/0" # Allow all for staging (less restrictive)
  allowed_ports: [22, 80, 443]

# Maintenance configuration
maintenance:
  enable_auto_updates: false
  enable_backup_before_deploy: true
  enable_rollback_snapshots: true

  # Scheduled maintenance
  maintenance_window:
    day: sunday
    hour: 2
    duration_hours: 4
